<!DOCTYPE HTML>
<html>
  <head>
    <style>
      body {
        margin: 0px;
        padding: 0px;
      }
    </style>
  </head>
  <body>
    <canvas id="myCanvas" width="578" height="250"></canvas>
    <script>
      window.requestAnimFrame = (function(callback) {
        return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame ||
        function(callback) {
          window.setTimeout(callback, 1000 / 60);
        };
      })();
      
      //pravi zupcanike
      function Zupcanik(config) {
        this.x = config.x;
        this.y = config.y;
        this.spoljniRadius = config.spoljniRadius;
        this.unutarRadius = config.unutarRadius;
        this.sredRadius = config.sredRadius;
        this.rupaRadius = config.rupaRadius;
        this.brojZubaca = config.brojZubaca;
        this.theta = config.theta;
        this.thetaBrzina = config.thetaBrzina / 1000;
        this.svetlaBoja = config.svetlaBoja;
        this.tamnaBoja = config.tamnaBoja;
        this.smerKazaljke = config.smerKazaljke;
      }

      // zupcanik crta
      Zupcanik.prototype.crta = function() {
        var canvas = document.getElementById('myCanvas');
        var platno = canvas.getContext('2d');

        platno.save();
        var brojTacaka = this.brojZubaca * 2;
        // crta zupcaniku zubce
        platno.beginPath();
        platno.lineJoin = 'bevel';
        for(var n = 0; n < brojTacaka; n++) {

          var poluprecnik = null;

          if(n % 2 == 0) {
            poluprecnik = this.spoljniRadius;
          }
          else {
            poluprecnik = this.unutarRadius;
          }

          var theta = this.theta;
          theta += ((Math.PI * 2) / brojTacaka) * (n + 1);

          var x = (poluprecnik * Math.sin(theta)) + this.x;
          var y = (poluprecnik * Math.cos(theta)) + this.y;

          if(n == 0) {
            platno.moveTo(x, y);
          }
          else {
            platno.lineTo(x, y);
          }
        }

        platno.closePath();
        platno.lineWidth = 5;
        platno.strokeStyle = this.tamnaBoja;
        platno.stroke();

        // crta telo zupcanika
        platno.beginPath();
        platno.arc(this.x, this.y, this.sredRadius, 0, 2 * Math.PI, false);

        var grd = platno.createLinearGradient(this.x - 100, this.y - 100, this.x + 100, this.y + 100);
        grd.addColorStop(0, this.svetlaBoja);
        grd.addColorStop(1, this.tamnaBoja);
        platno.fillStyle = grd;
        platno.fill();
        platno.lineWidth = 5;
        platno.strokeStyle = this.tamnaBoja;
        platno.stroke();

        // crta rupu zupcanika
        platno.beginPath();
        platno.arc(this.x, this.y, this.rupaRadius, 0, 2 * Math.PI, false);
        platno.fillStyle = 'white';
        platno.fill();
        platno.strokeStyle = this.tamnaBoja;
        platno.stroke();
        platno.restore();
      };
      function animate(zupcanici, zadnjeVreme) {
        var canvas = document.getElementById('myCanvas');
        var platno = canvas.getContext('2d');

        // azuriranje
        var vreme = (new Date()).getTime();
        var vremRazlika = vreme - zadnjeVreme;

        for(var i = 0; i < zupcanici.length; i++) {
          var zupcanik = zupcanici[i];

          if(zupcanici[i].smerKazaljke) {
            zupcanici[i].theta -= (zupcanik.thetaBrzina * vremRazlika);
          }
          else {
            zupcanici[i].theta += (zupcanik.thetaBrzina * vremRazlika);
          }
        }

        // clear
        platno.clearRect(0, 0, canvas.width, canvas.height);

        // crta
        for(var i = 0; i < zupcanici.length; i++) {
          zupcanici[i].crta();
        }

        // request new frame
        requestAnimFrame(function() {
          animate(zupcanici, vreme);
        });
      }
      var zupcanici = [];

      // blue zupcanik
      zupcanici.push(new Zupcanik({
        x: 120,
        y: 105,
        spoljniRadius: 90,
        unutarRadius: 50,
        sredRadius: 80,
        rupaRadius: 10,
        brojZubaca: 24,
        theta: 0,
        thetaBrzina: 1,
        svetlaBoja: '#B1CCFF',
        tamnaBoja: '#3959CC',
        smerKazaljke: false
      }));

      // crveni zupcanik
      zupcanici.push(new Zupcanik({
        x: 222,
        y: 190,
        spoljniRadius: 50,
        unutarRadius: 15,
        sredRadius: 40,
        rupaRadius: 10,
        brojZubaca: 12,
        theta: 0.14,
        thetaBrzina: 2,
        svetlaBoja: '#FF9E9D',
        tamnaBoja: '#AD0825',
        smerKazaljke: true
      }));

      // narandzasti zupcanik
      zupcanici.push(new Zupcanik({
        x: 272,
        y: 142,
        spoljniRadius: 28,
        unutarRadius: 5,
        sredRadius: 18,
        rupaRadius: 7,
        brojZubaca: 6,
        theta: 0.14,
        thetaBrzina: 4,
        svetlaBoja: '#FFDD87',
        tamnaBoja: '#D25D00',
        smerKazaljke: false
      }));

      // zeleni zupcanik
      zupcanici.push(new Zupcanik({
        x: 463,
        y: 144,
        spoljniRadius: 170,
        unutarRadius: 100,
        sredRadius: 160,
        rupaRadius: 10,
        brojZubaca: 48,
        theta: 0,
        thetaBrzina: 0.5,
        svetlaBoja: '#8AFF99',
        tamnaBoja: '#005C06',
        smerKazaljke: true
      }));

      var vreme = (new Date()).getTime();
      animate(zupcanici, vreme);

    </script>
  </body>
</html>
